<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="scss/mycss.css">
    <script src="https://kit.fontawesome.com/72a9c1090f.js" crossorigin="anonymous"></script>
    <title>NID Generator</title>

</head>
<style>
    /* #mainSVG{
        width: 100%;
        height: 500px;
    } */
</style>
<body>

    <!-- start-header -->
    <header class="header-generator">
        <nav class="navbar navbar-expand-lg navbar-light">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false"
                    aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <a class="navbar-brand" href="#">
                    <img src="images/logo1.png" class="img-fluid mlogo">
                    <span class="powerby">Powered by:
                        <img src="images/high_com.png" class="img-fluid mx-2">
                    </span>
                </a>
                <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
                    <ul class="navbar-nav ms-auto align-items-center mb-2 mb-lg-0 menu-style">
                        <li class="nav-item">
                            <a class="nav-link logout-btn" aria-current="page" href="#">Log out</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">
                                <!-- <img href="images/bars-staggered-solid.svg"> -->
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="22px"
                                    height="22px">
                                    <!--! Font Awesome Pro 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2022 Fonticons, Inc. -->
                                    <path
                                        d="M0 96C0 78.3 14.3 64 32 64H416c17.7 0 32 14.3 32 32s-14.3 32-32 32H32C14.3 128 0 113.7 0 96zM64 256c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H96c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32H32c-17.7 0-32-14.3-32-32s14.3-32 32-32H416c17.7 0 32 14.3 32 32z"
                                        fill="#fff" />
                                </svg>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <!-- end-header -->

    <!-- start-upload-section -->
    <div class="container mt-4 py-5 upload_pdf d-non">

        <div class="row">
            <div class="col-12">
                
                <h1 class="create-heading">Create, Upload and Get NID</h1>

                <form class="file-drop-area" method="POST" action="/" enctype="multipart/form-data">
                    <div class="text-center">
                        
                        <!-- <img src="" class="img-fluid"> -->
                        <img src="images/isolated-icon.jpg" class="img-fluid">
                    </div>
                    <span class="choose-file-button">Choose files</span><br><br>
                    <span class="file-message">Upload or drag your file here</span>
                    <input class="file-input" type="file" multiple id="inp_pdfFile" name="upload_pdfFile">
                    <input type="button" type="submit" value="submot" style="z-index: 99999; position: absolute; top: 120%;">
                </form>

            </div>
        </div>
    </div>
    <!-- end-upload-section -->

    <!-- start-preview-div -->
    <div class="container-fluid p-5 pdf_prev d-none">
        <div class="row">
            <div class="col-12 col-sm-6 text-center">
                <h4>Your PDF</h4>
                <div class="pdfViewer"></div>

                <textarea name="" id="result" cols="70" rows="20" class="d-none"></textarea>
                <!-- <div id="res" style="width:50%; height:600px; border:1px solid grey"></div> -->
                <!-- <img src="images/yourpdf.PNG" class="img-fluid" alt=""> -->
            </div>
            <div class="col-12 col-sm-6 py-5 py-sm-2 mt-sm-0 mt-4 shadow">
                <h3 class="text-center mb-4">Ready to download your NID</h3>
                <div class="w-25 select-width float-end">
                    <select class="form-select" aria-label="Default select example">
                        <option selected>Select Formate</option>
                    </select>
                </div>
                <div class="w-100 mt-5 text-center float-start">
                    <div id="NIDcard"></div>
                    <!-- <iframe width="100%" height="300" src="card.pdf#toolbar=0&navpanes=0&scrollbar=0" frameborder="0"></iframe> -->
                    <!-- <img src="images/nid.PNG" class="img-fluid" alt=""> -->
                    <!-- <textarea name="" id="result" cols="70" rows="18" class="d-none"></textarea>
                    <textarea cols="70" rows="18" id="extract_data"></textarea> -->
                </div>
                <div class="row justify-content-center pt-5 mt-4 text-center">
                    <button class="btn theme-btn">Download</button>
                </div>
            </div>
        </div>
    </div>
    <!-- end-preview-div -->


    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->

    <script src="https://code.jquery.com/jquery-3.6.0.js"
        integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function () {
            $(document).on('change', '.file-input', function () {

                var filesCount = $(this)[0].files.length;

                var textbox = $(this).prev();

                if (filesCount === 1) {
                    var fileName = $(this).val().split('\\').pop();
                    textbox.text(fileName);
                } else {
                    textbox.text(filesCount + ' files selected');
                }
                // console.log(filesCount)
                if (filesCount = !0) {
                    $(".upload_pdf").addClass("d-none");
                    $(".pdf_prev").removeClass("d-none");
                }

                var fileName = $(this)[0].files[0].name;
                var LM = $(this)[0].files[0].lastModifiedDate;
                // var detFile = $(this)[0].files[0].lastModifiedDate;
                
                // console.log(detFile);
                console.log(fileName);
                // var strDirectory = System.IO.Path.GetDirectoryName(strFullPath);
                var file = $("input[type=file]").get(0).files[0];
                console.log(file)
            if(file){
                    var reader = new FileReader();
        
                    reader.onload = function(){
                        $("div.pdfViewer").html(`<iframe id="prevPDF_File" width="100%" height="750" src="${reader.result}#toolbar=0&navpanes=0&scrollbar=0" frameborder="0"></iframe>`);
                        // $("div.pdfViewer").html(`<iframe id="prevPDF_File" width="100%" height="750" src="pdfs/${fileName}#toolbar=0&navpanes=0&scrollbar=0" frameborder="0"></iframe>`);
                        // console.log(reader.result)
                        // $("#previewImg").attr("src", reader.result);
                    }
        
                    reader.readAsDataURL(file);
                }
            
            });
            // function previewFile(input){
            // var file = $("input[type=file]").get(0).files[0];
            // if(file){
            //         var reader = new FileReader();
        
            //         reader.onload = function(){
            //             // $("div.pdfViewer").html(`<iframe id="prevPDF_File" width="100%" height="750" src="pdfs/${fileName}#toolbar=0&navpanes=0&scrollbar=0" frameborder="0"></iframe>`);
            //             console.log(reader.result)
            //             // $("#previewImg").attr("src", reader.result);
            //         }
        
            //         reader.readAsDataURL(file);
            //     }
            // }


        })
    </script>
    <script>
        const inp_pdfFile = document.getElementById("inp_pdfFile");
        const result = document.getElementById("result");
        const res = document.getElementById("extract_data");

        // $.get("./svg/card.svg")
        function getSvgData() {
            $.get(`./svg/card.svg`, null, function(data) {
                let svgdata = $(data).find("svg")[0];
                // console.log(svgdata);
                $("#NIDcard").html(svgdata);
            });
            
            
            // $.get(`./watchSVG/Daytona.svg`, null, function(data) {
            //     let innerPreview = $(data).find("svg")[0];
            //     $(innerPreview).find("#Case,#Winder,#Strap,#Bezel,#Bezel_Number,#Eng,#Crocodial_strap").remove();
            //     $("#innerPreview").html(innerPreview);
            // });
            
            // $("#PersonPicture").attr("xlink:href", "./imgExtPdf/img_p0_1.png");
            //     $("#PersonSign").attr("xlink:href","./imgExtPdf/img_p0_2.png");
        }
        getSvgData();

        
        inp_pdfFile.addEventListener("change", () => {
            const formData = new FormData();
            formData.append("pdfFile", inp_pdfFile.files[0]);
            fetch("/extract-text", {
                method: "post",
                body: formData
            }).then(response => {
                return response.text();
            }).then(extractedText => {
                getSvgData();

                setTimeout(() => {

                result.value = extractedText.trim();
                getVal = extractedText.trim();
                // alert(getVal)
                // console.log(getVal);

                let res_into_array = getVal.split("\n");

                for (var item of res_into_array) {
                    // console.log(item);
                }

                // let are = Array.form(res_into_array)
                // console.log(are);
                res_into_array.forEach((element) => {
                    // for (let i = 0; i < res_into_array.length; i++){
                    // if( res_into_array[element] == "Name(Bangla)" ){
                    // }
                    // element.find((map) => {
                    //     // console.log(map == "Name");

                    // });
                    // }

                });

                // let getData;
                var myObj = {};
                for (let i = 0; i < res_into_array.length; i++) {
                    myObj[i] = res_into_array[i];
                    // let find = res_into_array.find(map => {
                    //     if(map == "Name(Bangla)"){
                    //         console.log(find)
                    //         console.log(map)
                    //         // console.log();
                    //         return true;
                    //     }
                    // });
                    // console.log(find);
                    // res_into_array[i];
                    // if(find == "Name(Bangla)"){
                    // }
                    // if(res_into_array == "Name(bangla)"){// }

                    // let value = object.values(res_into_array);
                    // console.log(value)


                }

                // console.log(myObj)

                // getData = res_into_array.find("Name(Bangla)");   
                let seperate_array = res_into_array[0].split(" ");
                let splitArray = seperate_array[1];
                let getData = splitArray.replace("ID", "");
                console.log(getData);
                $("#extract_data").append("National ID:" + getData + "\n");
                $("#NID_NO").html(getData);

                // res.value = "National ID:" + getData;
                // getData

                let seperate_array2 = res_into_array[9].split(" ").join(" ") + res_into_array[10] + res_into_array[11] ;
                let getData2 = seperate_array2.replace("Name(Bangla)", "");
                console.log(getData2);
                $("#banglaName").html(getData2);
                // $("#extract_data").append("Name (Bangla): " + getData2 + " " + seperate_array2.splice(1, seperate_array2.length, seperate_array2) + "\n");
                // console.log("Name (Bangla): " + getData2 + " " + seperate_array2.splice(1, seperate_array2.length, seperate_array2));
                // let splitArray2 = seperate_array2[0];


                let seperate_array3 = res_into_array[12].split(" ");
                let splitArray3 = seperate_array3[0];
                let getData3 = splitArray3.replace("Name(English)", "");
                // $("#extract_data").append("Name (Eng): " + getData3 + " " + seperate_array3.splice(1, seperate_array3.length, seperate_array3) + "\n");
                // console.log(getData3 + " " + seperate_array3.splice(1, seperate_array3.length, seperate_array3));
                $("#englishName").html(getData3 + " " + seperate_array3[1]);


                let seperate_array4 = res_into_array[13].split(" ");
                //                 // console.log(seperate_array4);$("#extract_data").append(seperate_array4);
                let splitArray4 = seperate_array4[2];
                let getData4 = splitArray4.replace("Birth", "");
                console.log(getData4);
                $("#extract_data").append("Birth Of Date" + getData4 + "\n");
                // console.log(getData4 + " " + seperate_array4.splice(0,seperate_array4.length,seperate_array4));$("#extract_data").append(getData4 + " " + seperate_array4.splice(0,seperate_array4.length,seperate_array4));
                // $("#").html(getData3 + " " + seperate_array3[1]);
                $("#dateOB").html(getData4);



                let seperate_array5 = res_into_array[18].split(" ");
                //                 // console.log(seperate_array5);$("#extract_data").append(seperate_array5);
                let splitArray5 = seperate_array5[1];
                let getData5 = splitArray5.replace("Name", "");
                $("#extract_data").append("Father Name: " + getData5 + " " + seperate_array5.splice(2, seperate_array5.length).join(" ") + "\n");
                console.log(getData5 + " " + seperate_array5.splice(2, seperate_array5.length).join(" "));
                //                 // console.log(getData5);$("#extract_data").append(getData5);

                let seperate_array6 = res_into_array[19].split(" ");
                //                 // console.log(seperate_array6);$("#extract_data").append(seperate_array6);
                let splitArray6 = seperate_array6[1];
                let getData6 = splitArray6.replace("Name", "");
                console.log(getData6 + " " + seperate_array6.splice(2, seperate_array6.length).join(" "));
                $("#extract_data").append("Mother Name: " + getData6 + " " + seperate_array6.splice(2, seperate_array6.length).join(" ") + "\n");
                $("#motherName").html(getData6 + " " + seperate_array6.splice(2, seperate_array6.length).join(" "));


                let seperate_array7 = res_into_array[26].split(" ");
                let splitArray7 = seperate_array7[1];
                let getData7 = splitArray7.replace("AddressDivision", "").replace("District", " ").split(" ");
                $("#extract_data").append("Address: Division - " + getData7[0] + " Address: District - " + getData7[1] + "\n");
                console.log("Address: Division - " + getData7[0] + " Address: District - " + getData7[1]);
                // console.log(seperate_array7);$("#extract_data").append(seperate_array7);
                // console.log(AddressDivision + " District " + District );$("#extract_data").append(AddressDivision + " District " + District );
                // console.log(getData7 + " " + getData7.replace("District", " "));$("#extract_data").append(getData7 + " " + getData7.replace("District", " "));
                // console.log(getData7 + " " + seperate_array7.splice(2,seperate_array7.length).join(" "));$("#extract_data").append(getData7 + " " + seperate_array7.splice(2,seperate_array7.length).join(" "));

                let seperate_array8 = res_into_array[33] + " " + res_into_array[34];
                $("#extract_data").append("CCOM: " + seperate_array8 + "\n");
                console.log("CCOM: " + seperate_array8);
                $("#address").html(seperate_array8 );


                let seperate_array9 = res_into_array[35];
                let getData9 = seperate_array9.replace("Upozila", "").split("Union");
                console.log("Upozila: " + getData9[0]);
                $("#extract_data").append("Upozila: " + getData9[0] + "\n");

                let seperate_array10 = res_into_array[36];
                let getData10 = seperate_array10.replace("Mouza/Moholla", "").split("Additional");
                $("#extract_data").append("Mouza/Moholla: " + getData10[0] + "\n");
                console.log("Mouza/Moholla: " + getData10[0]);

                let seperate_array11 = res_into_array[38];
                $("#extract_data").append("Additional Mouza/Moholla: " + seperate_array11 + "\n");
                console.log("Additional Mouza/Moholla: " + seperate_array11);
                // let getData10 = seperate_array10.replace("Mouza/Moholla", "").split("Additional");

                let seperate_array12 = res_into_array[42];
                let getData12 = seperate_array12.replace("0Village/Road", "").split("Additional");
                $("#extract_data").append("Village/Road: " + getData12[0] + "\n");
                console.log("Village/Road: " + getData12[0]);

                let seperate_array13 = res_into_array[45] + " " + res_into_array[46] + " " + res_into_array[47] + " " + res_into_array[48];
                $("#extract_data").append("Additional Village/Road: " + seperate_array13 + "\n");
                console.log("Additional Village/Road: " + seperate_array13);

                let seperate_array14 = res_into_array[51] + " " + res_into_array[52];
                $("#extract_data").append("Home/Holding No: " + seperate_array14 + "\n");
                console.log("Home/Holding No: " + seperate_array14);

                let seperate_array15 = res_into_array[53].split(" ");
                //                 // console.log(seperate_array15);$("#extract_data").append(seperate_array15);
                let splitArray15 = seperate_array15[1];
                let splitArray15s = seperate_array15[2];
                let getData15 = splitArray15.replace("Office", "").replace("Postal", " ").split(" ");
                let getData15s = splitArray15s.replace("Code", "");
                $("#extract_data").append("Post Offiice: " + getData15[0] + " Postal Code: " + getData15s + "\n");
                console.log("Post Offiice: " + getData15[0] + " Postal Code: " + getData15s);
                //                 // console.log(getData15);$("#extract_data").append(getData15);

                let seperate_array16 = res_into_array[54].replace("Region", "");
                $("#extract_data").append("Region: " + seperate_array16 + "\n");
                console.log("Region: " + seperate_array16);

                let seperate_array17 = res_into_array[115].replace("Voter At", "");
                $("#extract_data").append("Voter At: " + seperate_array17);
                console.log("Voter At: " + seperate_array17);

                
                $("#fullAddress").html(getData15[0] + " - " + getData15s + ", " + seperate_array8);
                // PersonPicture
                // PersonSign
                // let getData13 = seperate_array13.replace("Village/Road", "").split("Additional");
                //                 // console.log("Village/Road: "+ getData13[0]);$("#extract_data").append("Village/Road: "+ getData13[0]);

                // 33 34

                // console.log(getData2.splice(13, getData2.length, getData2).join("") + " " + seperate_array2[1]);

                // $("#banglaName").html();
                // $("#englishName").html();
                // $("#address").html();
                // $("#motherName").html();
                // $("#dateOB").html();
                // $("#NID_NO").html();
                    
                }, 2000);
                
            });

            // {

            // let seperate = ['0','13'];
            // let seperate_array;
            // for(let getArray = 0; getArray < seperate.length; getArray++){
            //     // console.log(res_into_array[getArray]);
            // }                


            //                 let nId = ['national','id58192371'];
            // let id = nId[1].split("");
            // console.log(id)
            // console.log(id.splice(2, id.length, id) );
            // res.value = extractedText.trim();
            // let arr = ['1','2','3','4,'];
            // console.log(arr.splice(2, arr.length ,arr));

            // console.log("without trim \n",extractedText,"with trim \n",extractedText.trim());

            // fetch("/extract-text",{
            //     method: "post",
            //     body: formData
            // }),then( response => {
            //     return response.text();
            // }),then ( extractText => {
            //     result.value = extractText;
            // })
            // }
        });
    </script>
</body>

</html>